<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DWEB KeyChains and Access Control List example</title>
    <link rel='stylesheet' href='example_styles.css'>
    <script type="text/javascript" src="dweb_transport_ipfs_bundled.js"></script><!-- Load bundle - assigns to "Dweb"-->
    <script type="text/javascript" src="objbrowser.js"></script><!--objectbrowser functionality for debugging-->
    <script type="text/javascript" src="htmlutils.js"></script><!--Non Dweb specific utility functions for working with HTML-->
    <script type="text/javascript" src="loginutils.js"></script><!--Dweb login functions, useful in multiple places-->

    <script type="text/javascript">

        /* NOTES
         * As with the browser library, the convention p_xyz means the function is asynchronous and returns a Promise
         */


    </script>
</head>
<body class="exampleskeys">
    <div class="floatright">
        <div id="status">Starting</div>
        <ul id="keychains_ul"><!-- List of all existing keychains-->
        <li class='template vertical_li' onclick='keychain_click(this);'><span name='name'>PLACEHOLDER</span></li>
        </ul>
        <form><input id="logout" class="button" type="button" onclick="logout_click();" style="display:none;" value="Logout"/></form><!--logout all keychains-->
        <img src="noun_186903_cc.png" alt="keychain" class="iconopener" onclick="togglevis('logindiv','');"/>
    </div>
    <h1>Dweb - KeyChains and Access Control List Example</h1>
    <!-- General design
    Key Chains icon - opens / closes to
        List of Key Chains - names - click -> Key Chain management opens
        Passphrase & Login button - fill and login -> retrieved and listed above
        Register button -> click -> registration dialogue
    Registration dialogue [x]
        Name of KeyChain/Login, Pass Phrase
        Submit -> create KeyChain, add to KeyChains,
    Key Chain Management screen [x]
        Name of chain at top
        List of items in chain: Name; publickey; some links ->
        New Key button -> New Key Form
        New ACL button -> TBD
    New Key Form:
        Name,
        Generate button -> Generate key, add to KeyChain
    ACL screen [x]
        List of keys in ACL
        Way to add new Key based on string
        Need way to add this key to smartdict or list
    //TODO - need some example of using them
    -->
    <div id="logindiv" style="position:relative; left:25px; display:none;"><!-- needs position:relative, so parent for overdiv below-->
        <div class="displayedblock"><!--inline next to keychain-->
            <form class="dialogform" name="loginform" onsubmit="p_loginformsubmit(); return false;">
                <input class="propval" type="text" name="name" size="20" placeholder="Your id"/>
                <input class="propval" type="text" name="passphrase" size="70" placeholder="Passphrase"/>
                <input class="button" type="submit" value="Login"/>
                <input class="button" type="button" onclick="togglevis('registrationdiv','block');" value="Register"/>
            </form>
        </div>
        <div id="registrationdiv" class="overdiv" style="display:none">
            <form class="dialogform" name="registrationform" onsubmit="p_registrationsubmit(); return false;">
                <input class="propval" type="text" name="name" size="50" placeholder="Your id - it doesnt have to be unique"/>
                <input class="propval" type="text" name="passphrase" size="70" placeholder="Type a complex phrase, easy for you to remember, hard for others to guess, mixed case, numbers, punctuation are all good"/>
                <input class="button" type="submit" value="Register"/>
            </form>
        </div>

    </div>


    <div id="keychain" style="position:relative; display:none;"><!-- needs position:relative, so parent for overdiv below-->
        <div id="keylist_div" class="displayedblock">
            <div class="displayedblockheader" id="keychain_header">
                <form class="dialogform">
                    Keys on KeyChain:
                    <span name="name"></span>
                    <!--If change icons, see icon_images above-->
                    <img class="keylist_icon" src="noun_1146472_cc.png" alt="Key"/><input class="button" type="button" onclick="show('keynew_form');" value="new key"/>
                    <img class="keylist_icon" src="noun_1093404_cc.png" alt="Lock"/><input class="button" type="button" onclick="show('locknew_form');" value="new lock"/>
                    <img class="keylist_icon" src="noun_83161_cc.svg" alt="Close" onclick="hide('keychain');"/>
                </form>
            </div>
            <ul id="keychain_ul" class="inline_ul"><!-- List of all keys in keychain--></ul>
        </div>
    </div>
    <!--ACL display -->
    <div id="acl" style="position:relative;"><!-- needs position:relative, so parent for overdiv below-->
        <div id="lock_div" class="displayedblock" style="display:none">
            <div class="displayedblockheader" id="lock_header">
                Keys valid in lock: <span name="name"></span>

                <form class="dialogform">
                    <img class="keylist_icon" src="noun_1146472_cc.png" alt="Key"/><input class="button" type="button" onclick="show('tokennew_form');" value="new key"/>
                    <img class="keylist_icon" src="noun_83161_cc.svg" alt="Close" onclick="hide('acl');"/>
                </form>
            </div>
            <ul id="lock_ul" class="inline_ul"><!-- List of all tokens in AccessControlList--></ul>
        </div>


    </div>

    <hr><!-- Object Browser gives a way to look at the data structures being displayed -->

    <div class="container">
    <h4>Object browser <span class="hoverclue">....</span></h4>
    <div class="hoveronly">
    <ul class="hoveronly" id="ObjBrowser"></ul>
    </div>
    </div>

    <script type="text/javascript">
        // This is the "main()", starts a transport, checks its status, and if appropriate to app opens a URL passed
        const searchparms = new URL(window.location.href).searchParams;
        const url = searchparms.get("url");
        var verbose = searchparms.get("verbose") || false;  // Anything specified for verbose is true (could truthify buy no need)
        let transportclass = Dweb["Transport"+(searchparms.get("transport") || "IPFS").toUpperCase()]; // e.g. Dweb["TransportHTTP"]

        transportclass.p_setup({}, verbose)
            .then((t) => t.p_status())
            .then((msg) => setstatus(msg))
            .then(() => {
                // Any code you want to run once online goes here.
                //if(url) fetchanddisplay(url);  // In this app, ignoring any URL passed in call
            })
            .catch((err) => { console.log("ERROR:",err); alert(err.message); });
    </script>
</body>
</html>


